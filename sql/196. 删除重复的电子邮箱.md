# 627 å˜æ›´æ€§åˆ«

é¢˜ç›®é“¾æ¥ï¼š<https://leetcode.cn/problems/delete-duplicate-emails/>

```sql
# è‡ªè¿æ¥
# delete p1 from Person p1, Person p2 where p1.email = p2.email and p1.id > p2.id;

# not in
delete from Person where id not in (select * from (select min(id) from Person group by email) t)
```

## ä½¿ç”¨ DELETE å’Œ WHERE å­å¥è‡ªè¿æ¥

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼Œå°†æ­¤è¡¨ä¸å®ƒè‡ªèº«åœ¨ç”µå­é‚®ç®±åˆ—ä¸­è¿æ¥èµ·æ¥ã€‚

```sql
SELECT p1.*
FROM Person p1,
    Person p2
WHERE
    p1.Email = p2.Email
;
```

ç„¶åæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å…¶ä»–è®°å½•ä¸­å…·æœ‰ç›¸åŒç”µå­é‚®ä»¶åœ°å€çš„æ›´å¤§ IDã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ç»™ WHERE å­å¥æ·»åŠ ä¸€ä¸ªæ–°çš„æ¡ä»¶ã€‚

```sql
SELECT p1.*
FROM Person p1,
    Person p2
WHERE
    p1.Email = p2.Email AND p1.Id > p2.Id
;
```

å› ä¸ºæˆ‘ä»¬å·²ç»å¾—åˆ°äº†è¦åˆ é™¤çš„è®°å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆå¯ä»¥å°†è¯¥è¯­å¥æ›´æ”¹ä¸º DELETEã€‚

```sql
DELETE p1 FROM Person p1,
    Person p2
WHERE
    p1.Email = p2.Email AND p1.Id > p2.Id
```

## è§£é‡Š

è§£ç­”ç”¨äº†è‡ªè¿æ¥çš„æ–¹å¼ã€‚æœ‰æ…¢æŸ¥è¯¢ä¼˜åŒ–ç»éªŒçš„åŒå­¦ä¼šæ¸…æ¥šï¼Œåœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œé¢å¯¹åƒä¸‡ä¸Šäº¿çº§åˆ«çš„æ•°æ®ï¼Œè¿æ¥çš„æ•ˆç‡å¾€å¾€æœ€é«˜ï¼Œå› ä¸ºç”¨åˆ°ç´¢å¼•çš„æ¦‚ç‡è¾ƒé«˜ã€‚

å› æ­¤ï¼Œå»ºè®®å­¦ä¹ ä½¿ç”¨å®˜æ–¹çš„é¢˜è§£ï¼Œä½†æ˜¯æœ‰ä¸¤ç‚¹ï¼Œå¯èƒ½éœ€è¦å†è§£é‡Šä¸‹ï¼š

### DELETE p1

åœ¨[DELETEå®˜æ–¹æ–‡æ¡£](https://dev.mysql.com/doc/refman/8.0/en/delete.html)ä¸­ï¼Œç»™å‡ºäº†è¿™ä¸€ç”¨æ³•ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªDELETEè¯­å¥ğŸ‘‡

```sql
DELETE t1 FROM t1 LEFT JOIN t2 ON t1.id=t2.id WHERE t2.id IS NULL;
```

è¿™ç§DELETEæ–¹å¼å¾ˆé™Œç”Ÿï¼Œç«Ÿç„¶å’ŒSELETEçš„å†™æ³•ç±»ä¼¼ã€‚å®ƒæ¶‰åŠåˆ°t1å’Œt2ä¸¤å¼ è¡¨ï¼ŒDELETE t1è¡¨ç¤ºè¦åˆ é™¤t1çš„ä¸€äº›è®°å½•ï¼Œå…·ä½“åˆ å“ªäº›ï¼Œå°±çœ‹WHEREæ¡ä»¶ï¼Œæ»¡è¶³å°±åˆ ï¼›

è¿™é‡Œåˆ çš„æ˜¯t1è¡¨ä¸­ï¼Œè·Ÿt2åŒ¹é…ä¸ä¸Šçš„é‚£äº›è®°å½•ã€‚

æ‰€ä»¥ï¼Œå®˜æ–¹sqlä¸­ï¼ŒDELETE p1å°±è¡¨ç¤ºä»p1è¡¨ä¸­åˆ é™¤æ»¡è¶³WHEREæ¡ä»¶çš„è®°å½•ã€‚

### p1.Id > p2.Id

ç»§ç»­ä¹‹å‰ï¼Œå…ˆç®€å•çœ‹ä¸€ä¸‹è¡¨çš„è¿æ¥è¿‡ç¨‹ï¼Œè¿™ä¸ªææ‡‚äº†ï¼Œç†è§£WHEREæ¡ä»¶å°±ç®€å•äº†

- ä»é©±åŠ¨è¡¨ï¼ˆå·¦è¡¨ï¼‰å–å‡ºNæ¡è®°å½•
- æ‹¿ç€è¿™Næ¡è®°å½•ï¼Œä¾æ¬¡åˆ°è¢«é©±åŠ¨è¡¨ï¼ˆå³è¡¨ï¼‰æŸ¥æ‰¾æ»¡è¶³WHEREæ¡ä»¶çš„è®°å½•

æ‰€ä»¥ï¼Œå®˜æ–¹sqlçš„è¿‡ç¨‹å°±æ˜¯

å…ˆæŠŠPersonè¡¨æ¬è¿‡æ¥

```text
+----+------------------+
| id | email            |
+----+------------------+
| 1  | john@example.com |
| 2  | bob@example.com  |
| 3  | john@example.com |
+----+------------------+
```

- ä»è¡¨p1å–å‡º3æ¡è®°å½•
- æ‹¿ç€ç¬¬1æ¡è®°å½•å»è¡¨p2æŸ¥æ‰¾æ»¡è¶³WHEREçš„è®°å½•ï¼Œä»£å…¥è¯¥æ¡ä»¶p1.Email = p2.Email AND p1.Id > p2.Idåï¼Œå‘ç°æ²¡æœ‰æ»¡è¶³çš„ï¼Œæ‰€ä»¥ä¸ç”¨åˆ æ‰è®°å½•1
- è®°å½•2åŒç†
- æ‹¿ç€ç¬¬3æ¡è®°å½•å»è¡¨p2æŸ¥æ‰¾æ»¡è¶³WHEREçš„è®°å½•ï¼Œå‘ç°æœ‰ä¸€æ¡è®°å½•æ»¡è¶³ï¼Œæ‰€ä»¥è¦ä»p1åˆ æ‰è®°å½•3
- 3æ¡è®°å½•éå†å®Œï¼Œåˆ æ‰äº†1æ¡è®°å½•ï¼Œè¿™ä¸ªDELETEä¹Ÿå°±ç»“æŸäº†

## æŸ¥æ‰¾é‡å¤æ•°æ®

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•åœ¨MySQLä¸­æŸ¥æ‰¾ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—çš„é‡å¤å€¼ã€‚

ç”±äºè®¸å¤šåŸå› ï¼Œé‡å¤æ•°æ®åº“åœ¨æ•°æ®åº“ä¸­ä¼šç»å¸¸å‘ç”Ÿã€‚æŸ¥æ‰¾é‡å¤å€¼æ˜¯ä½¿ç”¨æ•°æ®åº“æ—¶å¿…é¡»å¤„ç†çš„é‡è¦ä»»åŠ¡ä¹‹ä¸€ã€‚

### å‡†å¤‡é‡å¤æ ·æœ¬æ•°æ®

å¯¹äºæ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªè¡¨å‘½åä¸ºcontactså››åˆ—ï¼šidï¼Œfirst_nameï¼Œlast_nameï¼Œå’Œemailã€‚

```sql
DROP TABLE IF EXISTS contacts_test;
CREATE TABLE contacts_test (
    id INT PRIMARY KEY AUTO_INCREMENT,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(255) NOT NULL
);
```

ä»¥ä¸‹è¯­å¥å°†è¡Œæ’å…¥contacts_testè¡¨ä¸­ï¼š

```sql
INSERT INTO contacts_test (first_name,last_name,email) 
VALUES ('Carine ','Schmitt','carine.schmitt@verizon.net'),
       ('Jean','King','jean.king@me.com'),
       ('Peter','Ferguson','peter.ferguson@google.com'),
       ('Janine ','Labrune','janine.labrune@aol.com'),
       ('Jonas ','Bergulfsen','jonas.bergulfsen@mac.com'),
       ('Janine ','Labrune','janine.labrune@aol.com'),
       ('Susan','Nelson','susan.nelson@comcast.net'),
       ('Zbyszek ','Piestrzeniewicz','zbyszek.piestrzeniewicz@att.net'),
       ('Roland','Keitel','roland.keitel@yahoo.com'),
       ('Julie','Murphy','julie.murphy@yahoo.com'),
       ('Kwai','Lee','kwai.lee@google.com'),
       ('Jean','King','jean.king@me.com'),
       ('Susan','Nelson','susan.nelson@comcast.net'),
       ('Roland','Keitel','roland.keitel@yahoo.com');
```

```sql
SELECT
    *
FROM
    contacts_test;
```

```text
+----+------------+-----------------+---------------------------------+
| id | first_name | last_name       | email                           |
+----+------------+-----------------+---------------------------------+
|  1 | Carine     | Schmitt         | carine.schmitt@verizon.net      |
|  2 | Jean       | King            | jean.king@me.com                |
|  3 | Peter      | Ferguson        | peter.ferguson@google.com       |
|  4 | Janine     | Labrune         | janine.labrune@aol.com          |
|  5 | Jonas      | Bergulfsen      | jonas.bergulfsen@mac.com        |
|  6 | Janine     | Labrune         | janine.labrune@aol.com          |
|  7 | Susan      | Nelson          | susan.nelson@comcast.net        |
|  8 | Zbyszek    | Piestrzeniewicz | zbyszek.piestrzeniewicz@att.net |
|  9 | Roland     | Keitel          | roland.keitel@yahoo.com         |
| 10 | Julie      | Murphy          | julie.murphy@yahoo.com          |
| 11 | Kwai       | Lee             | kwai.lee@google.com             |
| 12 | Jean       | King            | jean.king@me.com                |
| 13 | Susan      | Nelson          | susan.nelson@comcast.net        |
| 14 | Roland     | Keitel          | roland.keitel@yahoo.com         |
+----+------------+-----------------+---------------------------------+
14 rows in set (0.00 sec)
```

åœ¨contacts_testè¡¨ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€äº›è¡Œæ˜¯æœ‰é‡å¤çš„å€¼first_nameï¼Œlast_nameå’Œemailåˆ—ã€‚è®©æˆ‘ä»¬å­¦ä¹ å¦‚ä½•æ‰¾åˆ°å®ƒä»¬ã€‚

### æŸ¥æ‰¾ä¸€åˆ—ä¸­çš„é‡å¤å€¼

```sql
SELECT
    col,
    COUNT(col)
FROM
    table_name
GROUP BY col
HAVING COUNT(col) > 1;
```

å¦‚æœåœ¨è¡¨ä¸­å‡ºç°å¤šä¸ªå€¼ï¼Œåˆ™è®¤ä¸ºå€¼æ˜¯é‡å¤çš„ã€‚åœ¨è¿™ä¸ªè¯­å¥ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`GROUP BY`å¸¦æœ‰`COUNT`å‡½æ•°çš„å­å¥æ¥è®¡ç®—æŒ‡å®šåˆ—ï¼ˆcolï¼‰çš„å€¼ã€‚`HAVING` å­å¥ä¸­çš„æ¡ä»¶ä»…åŒ…æ‹¬å€¼countå¤§äº1çš„è¡Œï¼Œå³é‡å¤çš„è¡Œã€‚

æ‚¨å¯ä»¥ä½¿ç”¨æ­¤æŸ¥è¯¢æŸ¥æ‰¾`contacts`è¡¨ä¸­åŒ…å«é‡å¤ç”µå­é‚®ä»¶çš„æ‰€æœ‰è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```sql
SELECT
    email,
    COUNT(email)
FROM
    contacts_test
GROUP BY email
HAVING COUNT(email) > 1;
```

ä»¥ä¸‹æ˜¾ç¤ºäº†æŸ¥è¯¢çš„è¾“å‡ºï¼š

```text
+--------------------------+--------------+
| email                    | COUNT(email) |
+--------------------------+--------------+
| janine.labrune@aol.com   |            2 |
| jean.king@me.com         |            2 |
| roland.keitel@yahoo.com  |            2 |
| susan.nelson@comcast.net |            2 |
+--------------------------+--------------+
4 rows in set (0.00 sec)
```

å¦‚æ‚¨æ‰€è§ï¼Œæœ‰äº›è¡Œå…·æœ‰ç›¸åŒçš„ç”µå­é‚®ä»¶ã€‚

### æŸ¥æ‰¾å¤šåˆ—ä¸­é‡å¤å€¼

æœ‰æ—¶ï¼Œæ‚¨å¸Œæœ›åŸºäºå¤šä¸ªåˆ—è€Œä¸æ˜¯ä¸€ä¸ªåˆ—æ‰¾åˆ°é‡å¤é¡¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢ï¼š

```sql
SELECT
    col1, COUNT(col1),
    col2, COUNT(col2),
    ...

FROM
    table_name
GROUP BY
    col1,
    col2, ...
HAVING
       (COUNT(col1) > 1) AND
       (COUNT(col2) > 1) AND
       ...
```

ä»…å½“åˆ—çš„ç»„åˆé‡å¤æ—¶ï¼Œè¡Œæ‰è¢«è§†ä¸ºé‡å¤ï¼Œå› æ­¤æˆ‘ä»¬åœ¨`HAVING`å­å¥ä¸­ä½¿ç”¨äº†`AND`è¿ç®—ç¬¦ã€‚

ä¾‹å¦‚ï¼Œè¦æŸ¥æ‰¾çš„è¡Œcontacts_testè¡¨ä¸­é‡å¤å€¼first_nameï¼Œlast_nameå’Œemailåˆ—ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æŸ¥è¯¢ï¼š

```sql
SELECT
    first_name, COUNT(first_name),
    last_name,  COUNT(last_name),
    email,      COUNT(email)
FROM
    contacts_test
GROUP BY
    first_name ,
    last_name ,
    email
HAVING  COUNT(first_name) > 1
    AND COUNT(last_name) > 1
    AND COUNT(email) > 1;
```

ä»¥ä¸‹è¯´æ˜äº†æŸ¥è¯¢çš„è¾“å‡ºï¼š

```text
+------------+-------------------+-----------+------------------+--------------------------+--------------+
| first_name | COUNT(first_name) | last_name | COUNT(last_name) | email                    | COUNT(email) |
+------------+-------------------+-----------+------------------+--------------------------+--------------+
| Janine     |                 2 | Labrune   |                2 | janine.labrune@aol.com   |            2 |
| Jean       |                 2 | King      |                2 | jean.king@me.com         |            2 |
| Roland     |                 2 | Keitel    |                2 | roland.keitel@yahoo.com  |            2 |
| Susan      |                 2 | Nelson    |                2 | susan.nelson@comcast.net |            2 |
+------------+-------------------+-----------+------------------+--------------------------+--------------+
4 rows in set (0.00 sec)
```

## åˆ é™¤é‡å¤æ•°æ®

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ åˆ é™¤MySQLä¸­é‡å¤è¡Œçš„å„ç§æ–¹æ³•ã€‚

åœ¨ä¸Šä¸€ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘æ‚¨å±•ç¤ºäº†å¦‚ä½•åœ¨è¡¨ä¸­æŸ¥æ‰¾é‡å¤å€¼ã€‚è¯†åˆ«å‡ºé‡å¤è¡Œåï¼Œæ‚¨å¯èƒ½å¸Œæœ›åˆ é™¤å®ƒä»¬ä»¥æ¸…ç†æ•°æ®ã€‚

### å‡†å¤‡æ ·æœ¬æ•°æ®

ä¸‹é¢çš„è„šæœ¬åˆ›å»ºçš„contacts_testè¡¨å’Œæ’å…¥é‡‡æ ·æ•°æ®åˆ°contacts_testè¡¨ä¸­ä¸ºç¤ºèŒƒã€‚

```sql
DROP TABLE IF EXISTS contacts_test;

CREATE TABLE contacts_test (
    id INT PRIMARY KEY AUTO_INCREMENT,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(255) NOT NULL
);

INSERT INTO contacts_test (first_name,last_name,email) 
VALUES ('Carine ','Schmitt','carine.schmitt@verizon.net'),
       ('Jean','King','jean.king@me.com'),
       ('Peter','Ferguson','peter.ferguson@google.com'),
       ('Janine ','Labrune','janine.labrune@aol.com'),
       ('Jonas ','Bergulfsen','jonas.bergulfsen@mac.com'),
       ('Janine ','Labrune','janine.labrune@aol.com'),
       ('Susan','Nelson','susan.nelson@comcast.net'),
       ('Zbyszek ','Piestrzeniewicz','zbyszek.piestrzeniewicz@att.net'),
       ('Roland','Keitel','roland.keitel@yahoo.com'),
       ('Julie','Murphy','julie.murphy@yahoo.com'),
       ('Kwai','Lee','kwai.lee@google.com'),
       ('Jean','King','jean.king@me.com'),
       ('Susan','Nelson','susan.nelson@comcast.net'),
       ('Roland','Keitel','roland.keitel@yahoo.com');
```

æ‚¨å¯ä»¥åœ¨æ‰§è¡ŒDELETEè¯­å¥åæ‰§è¡Œæ­¤è„šæœ¬ä»¥é‡æ–°åˆ›å»ºæµ‹è¯•æ•°æ®ã€‚

ä»¥ä¸‹æŸ¥è¯¢è¿”å›è¡¨ä¸­çš„é‡å¤ç”µå­é‚®ä»¶contacts_testï¼š

```sql
SELECT
    email, COUNT(email)
FROM
    contacts_test
GROUP BY
    email
HAVING
    COUNT(email) > 1;
```

```text
+--------------------------+--------------+
| email                    | COUNT(email) |
+--------------------------+--------------+
| janine.labrune@aol.com   |            2 |
| jean.king@me.com         |            2 |
| roland.keitel@yahoo.com  |            2 |
| susan.nelson@comcast.net |            2 |
+--------------------------+--------------+
4 rows in set (0.00 sec)
```

å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬æœ‰å››è¡Œé‡å¤çš„ç”µå­é‚®ä»¶ã€‚

### ä½¿ç”¨DELETE JOINè¯­å¥åˆ é™¤é‡å¤çš„è¡Œ

MySQLä¸ºæ‚¨æä¾›äº†`DELETE JOIN`å¯ç”¨äºå¿«é€Ÿåˆ é™¤é‡å¤è¡Œçš„è¯­å¥ã€‚

ä»¥ä¸‹è¯­å¥åˆ é™¤é‡å¤è¡Œå¹¶ä¿ç•™æœ€é«˜IDï¼š

```sql
DELETE t1 FROM contacts_test t1
        INNER JOIN
    contacts_test t2
WHERE
    t1.id < t2.id AND t1.email = t2.email;
```

è¾“å‡ºæ˜¯ï¼š

```text
Query OK, 4 rows affected (0.10 sec)
```

å®ƒè¡¨æ˜å·²åˆ é™¤äº†å››è¡Œã€‚æ‚¨å¯ä»¥æ‰§è¡Œå†æ¬¡æŸ¥æ‰¾é‡å¤ç”µå­é‚®ä»¶çš„æŸ¥è¯¢ä»¥éªŒè¯åˆ é™¤ï¼š

```sql
SELECT
    email,
    COUNT(email)
FROM
    contacts_test
GROUP BY
    email
HAVING
    COUNT(email) > 1;
```

æŸ¥è¯¢è¿”å›ä¸€ä¸ªç©ºé›†ï¼Œè¿™æ„å‘³ç€å·²åˆ é™¤é‡å¤çš„è¡Œã€‚

è®©æˆ‘ä»¬éªŒè¯contacts_testè¡¨æ ¼ä¸­çš„æ•°æ®ï¼š

```sql
SELECT
    *
FROM
    contacts_test;
```

```text
+----+------------+-----------------+---------------------------------+
| id | first_name | last_name       | email                           |
+----+------------+-----------------+---------------------------------+
|  1 | Carine     | Schmitt         | carine.schmitt@verizon.net      |
|  3 | Peter      | Ferguson        | peter.ferguson@google.com       |
|  5 | Jonas      | Bergulfsen      | jonas.bergulfsen@mac.com        |
|  6 | Janine     | Labrune         | janine.labrune@aol.com          |
|  8 | Zbyszek    | Piestrzeniewicz | zbyszek.piestrzeniewicz@att.net |
| 10 | Julie      | Murphy          | julie.murphy@yahoo.com          |
| 11 | Kwai       | Lee             | kwai.lee@google.com             |
| 12 | Jean       | King            | jean.king@me.com                |
| 13 | Susan      | Nelson          | susan.nelson@comcast.net        |
| 14 | Roland     | Keitel          | roland.keitel@yahoo.com         |
+----+------------+-----------------+---------------------------------+
10 rows in set (0.00 sec)
```

idä¸º2,4,7å’Œ9çš„è¡Œå·²è¢«åˆ é™¤ã€‚

å¦‚æœè¦åˆ é™¤é‡å¤è¡Œå¹¶ä¿ç•™æœ€ä½IDï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥ï¼š

```sql
DELETE t1 FROM contacts_test t1
        INNER JOIN
    contacts_test t2
WHERE
    t1.id > t2.id AND t1.email = t2.email;
```

æ³¨æ„ï¼šæ‚¨å¯ä»¥å†æ¬¡æ‰§è¡Œç”¨äºåˆ›å»ºcontacts_testè¡¨çš„è„šæœ¬å¹¶æµ‹è¯•æ­¤æŸ¥è¯¢ã€‚ä»¥ä¸‹è¾“å‡ºæ˜¾ç¤ºåˆ é™¤é‡å¤è¡Œåcontacts_testè¡¨çš„æ•°æ®ã€‚

```text
+----+------------+-----------------+---------------------------------+
| id | first_name | last_name       | email                           |
+----+------------+-----------------+---------------------------------+
|  1 | Carine     | Schmitt         | carine.schmitt@verizon.net      |
|  2 | Jean       | King            | jean.king@me.com                |
|  3 | Peter      | Ferguson        | peter.ferguson@google.com       |
|  4 | Janine     | Labrune         | janine.labrune@aol.com          |
|  5 | Jonas      | Bergulfsen      | jonas.bergulfsen@mac.com        |
|  7 | Susan      | Nelson          | susan.nelson@comcast.net        |
|  8 | Zbyszek    | Piestrzeniewicz | zbyszek.piestrzeniewicz@att.net |
|  9 | Roland     | Keitel          | roland.keitel@yahoo.com         |
| 10 | Julie      | Murphy          | julie.murphy@yahoo.com          |
| 11 | Kwai       | Lee             | kwai.lee@google.com             |
+----+------------+-----------------+---------------------------------+
10 rows in set (0.00 sec)
```

### ä½¿ç”¨ä¸­é—´è¡¨åˆ é™¤é‡å¤çš„è¡Œ

ä»¥ä¸‹æ˜¾ç¤ºäº†ä½¿ç”¨ä¸­é—´è¡¨åˆ é™¤é‡å¤è¡Œçš„æ­¥éª¤ï¼š

- åˆ›å»ºä¸€ä¸ªæ–°è¡¨ï¼Œå…¶ç»“æ„ä¸è¦åˆ é™¤é‡å¤è¡Œçš„åŸå§‹è¡¨ç›¸åŒã€‚
- å°†åŸå§‹è¡¨ä¸­çš„ä¸åŒè¡Œæ’å…¥åˆ°ç›´æ¥è¡¨ä¸­ã€‚
- åˆ é™¤åŸå§‹è¡¨å’Œé‡å‘½åç«‹å³è¡¨çš„åŸå§‹è¡¨ã€‚

```sql
# æ­¥éª¤1ã€‚
CREATE TABLE source_copy LIKE source;
# ç¬¬2æ­¥ã€‚
INSERT INTO source_copy
SELECT * FROM source
GROUP BY col; -- col æ˜¯æœ‰é‡å¤æ•°æ®çš„åˆ— 
# ç¬¬3æ­¥ã€‚
DROP TABLE source;
ALTER TABLE source_copy RENAME TO source;
```

ä¾‹å¦‚ï¼Œä»¥ä¸‹è¯­å¥ä»contacts_testè¡¨ä¸­åˆ é™¤åŒ…å«é‡å¤ç”µå­é‚®ä»¶çš„è¡Œï¼š

```sql
-- step 1
CREATE TABLE contacts_temp
LIKE contacts_test;

-- step 2
INSERT INTO contacts_temp
SELECT *
FROM contacts_test
GROUP BY email,id;


-- step 3
DROP TABLE contacts_test;

ALTER TABLE contacts_temp
RENAME TO contacts_test;
```

### ä½¿ç”¨ROW_NUMBER() å‡½æ•°åˆ é™¤é‡å¤çš„è¡Œ

è¯·æ³¨æ„ï¼Œ`ROW_NUMBER()`è‡ªMySQLç‰ˆæœ¬8.02èµ·ï¼ŒåŠŸèƒ½å·²å¾—åˆ°æ”¯æŒï¼Œå› æ­¤æ‚¨åº”åœ¨ä½¿ç”¨åŠŸèƒ½ä¹‹å‰æ£€æŸ¥æ‚¨çš„MySQLç‰ˆæœ¬ã€‚

ä»¥ä¸‹è¯­å¥ä½¿ç”¨`ROW_NUMBER()`å‡½æ•°ä¸ºæ¯è¡Œåˆ†é…ä¸€ä¸ªé¡ºåºæ•´æ•°ã€‚å¦‚æœç”µå­é‚®ä»¶é‡å¤ï¼Œåˆ™è¡Œå·å°†å¤§äº1ã€‚

ä»¥ä¸‹è¯­å¥è¿”å›é‡å¤è¡Œçš„idåˆ—è¡¨ï¼š

```sql
SELECT
 id
FROM (
 SELECT
 id,
 ROW_NUMBER() OVER (
 PARTITION BY email
 ORDER BY email) AS row_num
 FROM
 contacts_test
) t
WHERE
 row_num > 1;
```

```text
+----+
| id |
+----+
|  6 |
| 12 |
| 14 |
| 13 |
+----+
10 rows in set (0.00 sec)
```

è€Œä½ åªæ˜¯åˆ é™¤ä»é‡å¤çš„è¡Œcontactsä½¿ç”¨è¡¨DELETEä¸è¯­å¥å­æŸ¥è¯¢ ä¸­çš„WHEREæ¡æ¬¾ï¼š

```sql
DELETE FROM contacts_test
WHERE
 id IN (
 SELECT
 id
 FROM (
 SELECT
 id,
 ROW_NUMBER() OVER (
 PARTITION BY email
 ORDER BY email) AS row_num
 FROM
 contacts_test
 ) t
    WHERE row_num > 1
);
```

MySQLå‘å‡ºä»¥ä¸‹æ¶ˆæ¯ï¼š

```text
4 row(s) affected
```
